<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Medicare</title>
    <link rel="stylesheet" href="css/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .admin-tabs {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
      }
      .tab-btn-admin {
        padding: 1rem 2rem;
        border: 2px solid #e5e7eb;
        background: white;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s;
      }
      .tab-btn-admin.active {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        border-color: #8b5cf6;
      }
      .doctors-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 1.5rem;
      }
      .doctor-card {
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        padding: 1.5rem;
        position: relative;
      }
      .doctor-actions {
        position: absolute;
        top: 1rem;
        right: 1rem;
      }
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
      }
      .stats-grid-admin {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }
    </style>
  </head>
  <body class="dashboard-page admin-dashboard">
    <nav class="top-navbar">
      <div class="nav-left">
        <i class="fas fa-cogs"></i>
        <span>Admin Dashboard</span>
      </div>
      <div class="nav-right">
        <div class="user-profile">
          <img src="" alt="Profile" class="profile-img" id="profileImg" />
          <span id="userName">Admin</span>
          <span class="role-badge admin" id="userRole">Admin</span>
        </div>
        <button class="btn-logout" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </nav>

    <div class="dashboard-wrapper">
      <main class="main-content">
        <header class="page-header">
          <h1 id="welcomeMsg">
            Welcome back,
            <span class="gradient-text" id="welcomeName">Admin</span>! ðŸ‘‹
          </h1>
          <p>Manage doctors, hospitals, and system settings</p>
        </header>

        <div class="admin-tabs">
          <button class="tab-btn-admin active" data-tab="doctors">
            Doctors
          </button>
          <button class="tab-btn-admin" data-tab="add-doctor">
            Add Doctor
          </button>
          <button class="tab-btn-admin" data-tab="stats">Statistics</button>
        </div>

        <!-- Doctors Management -->
        <section id="doctors-section" class="tab-content active">
          <div class="stats-grid-admin">
            <div class="stat-card primary">
              <div class="stat-icon"><i class="fas fa-user-md"></i></div>
              <div class="stat-numbers">
                <h3 id="totalDoctors">0</h3>
                <p>Total Doctors</p>
              </div>
            </div>
            <div class="stat-card success">
              <div class="stat-icon"><i class="fas fa-hospital"></i></div>
              <div class="stat-numbers">
                <h3 id="totalHospitals">0</h3>
                <p>Total Hospitals</p>
              </div>
            </div>
          </div>
          <div class="doctors-grid" id="doctorsGrid">
            <!-- Dynamic doctor cards -->
          </div>
        </section>

        <!-- Add Doctor Form -->
        <section id="add-doctor-section" class="tab-content">
          <div class="metrics-card">
            <div class="card-header">
              <h2><i class="fas fa-user-plus"></i> Add New Doctor</h2>
            </div>
            <form class="metrics-form" onsubmit="addDoctor(event)">
              <div class="form-grid">
                <div class="form-group">
                  <label><i class="fas fa-user-md"></i> Doctor Name</label>
                  <input type="text" id="doctorName" required />
                </div>
                <div class="form-group">
                  <label><i class="fas fa-envelope"></i> Email</label>
                  <input type="email" id="doctorEmail" required />
                </div>
                <div class="form-group">
                  <label
                    ><i class="fas fa-stethoscope"></i> Specialization</label
                  >
                  <input
                    type="text"
                    id="specialization"
                    placeholder="Cardiology, Neurology, etc."
                    required
                  />
                </div>
                <div class="form-group">
                  <label><i class="fas fa-hospital"></i> Hospitals</label>
                  <input
                    type="text"
                    id="hospitals"
                    placeholder="Hospital A, Hospital B"
                  />
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn-primary btn-large">
                  <i class="fas fa-plus"></i> Add Doctor
                </button>
              </div>
            </form>
          </div>
        </section>

        <!-- Statistics -->
        <section id="stats-section" class="tab-content">
          <div class="stats-grid-admin">
            <div class="stat-card primary">
              <div class="stat-icon"><i class="fas fa-users"></i></div>
              <div class="stat-numbers">
                <h3 id="totalPatients">0</h3>
                <p>Total Patients</p>
              </div>
            </div>
            <div class="stat-card success">
              <div class="stat-icon"><i class="fas fa-calendar"></i></div>
              <div class="stat-numbers">
                <h3 id="totalAppointments">0</h3>
                <p>Total Appointments</p>
              </div>
            </div>
            <div class="stat-card warning">
              <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
              <div class="stat-numbers">
                <h3 id="activeUsers">0</h3>
                <p>Active Users Today</p>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const currentUser = JSON.parse(
          localStorage.getItem("medicare_current_user") || "{}",
        );

        if (!currentUser || currentUser.role !== "admin") {
          window.location.href = "login.html";
          return;
        }

        loadAdminData(currentUser);
        loadDoctors();
        loadStats();
        bindEvents();
      });

      function loadAdminData(currentUser) {
        document.getElementById("welcomeName").textContent = currentUser.name;
        document.getElementById("userName").textContent = currentUser.name;
        document.getElementById("profileImg").src =
          currentUser.picture ||
          `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.name)}&background=8b5cf6&color=fff&size=40`;
      }

      function bindEvents() {
        // Tab switching
        document.querySelectorAll(".tab-btn-admin").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            document
              .querySelectorAll(".tab-btn-admin")
              .forEach((b) => b.classList.remove("active"));
            document
              .querySelectorAll(".tab-content")
              .forEach((c) => c.classList.remove("active"));
            btn.classList.add("active");
            document
              .getElementById(btn.dataset.tab + "-section")
              .classList.add("active");
          });
        });

        window.logout = function () {
          localStorage.removeItem("medicare_current_user");
          window.location.href = "login.html";
        };
      }

      function loadDoctors() {
        const users = JSON.parse(
          localStorage.getItem("medicare_users") || "[]",
        );
        const doctors = users.filter((u) => u.role === "doctor");

        displayDoctors(doctors);
        document.getElementById("totalDoctors").textContent = doctors.length;
      }

      function displayDoctors(doctors) {
        const grid = document.getElementById("doctorsGrid");
        grid.innerHTML = doctors
          .map(
            (doctor, index) => `
      <div class="doctor-card">
        <div class="doctor-actions">
          <button class="btn-secondary btn-sm mr-2" onclick="editDoctor('${doctor.email}')">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn-danger btn-sm" onclick="deleteDoctor('${doctor.email}')">
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <div class="flex items-center gap-3 mb-4">
          <img src="${doctor.picture}" class="w-14 h-14 rounded-full" />
          <div>
            <h3 class="font-bold text-xl">${doctor.name}</h3>
            <p class="text-sm text-gray-500">${doctor.email}</p>
          </div>
        </div>
        <div class="info-grid">
          <div class="info-item">
            <span>Specialization</span>
            <strong>${doctor.specialization || "Not set"}</strong>
          </div>
          <div class="info-item">
            <span>Hospitals</span>
            <strong>${doctor.hospitals ? doctor.hospitals.join(", ") : "None"}</strong>
          </div>
          <div class="info-item">
            <span>Timings</span>
            <strong>${Object.keys(doctor.timings || {}).length} days set</strong>
          </div>
        </div>
      </div>
    `,
          )
          .join("");
      }

      function loadStats() {
        const users = JSON.parse(
          localStorage.getItem("medicare_users") || "[]",
        );
        document.getElementById("totalPatients").textContent = users.filter(
          (u) => u.role === "patient",
        ).length;
        document.getElementById("totalHospitals").textContent = "12"; // Mock data
        document.getElementById("activeUsers").textContent = "47"; // Mock data
      }

      window.addDoctor = function (event) {
        event.preventDefault();

        const doctorData = {
          name: document.getElementById("doctorName").value,
          email: document.getElementById("doctorEmail").value.toLowerCase(),
          role: "doctor",
          specialization: document.getElementById("specialization").value,
          hospitals: document
            .getElementById("hospitals")
            .value.split(",")
            .map((h) => h.trim())
            .filter((h) => h),
          timings: {
            Monday: "09:00 - 17:00",
            Wednesday: "09:00 - 17:00",
            Friday: "09:00 - 17:00",
          },
        };

        const users = JSON.parse(
          localStorage.getItem("medicare_users") || "[]",
        );
        const existingIndex = users.findIndex(
          (u) => u.email === doctorData.email,
        );

        if (existingIndex !== -1) {
          showNotification("Doctor already exists!", "error");
          return;
        }

        users.push(doctorData);
        localStorage.setItem("medicare_users", JSON.stringify(users));

        showNotification("Doctor added successfully!", "success");
        loadDoctors();
        event.target.reset();
      };

      window.editDoctor = function (email) {
        alert(`Edit doctor features coming soon!\nDoctor Email: ${email}`);
      };

      window.deleteDoctor = function (email) {
        if (confirm("Are you sure you want to delete this doctor?")) {
          let users = JSON.parse(
            localStorage.getItem("medicare_users") || "[]",
          );
          users = users.filter((u) => u.email !== email);
          localStorage.setItem("medicare_users", JSON.stringify(users));
          loadDoctors();
          showNotification("Doctor deleted successfully!", "success");
        }
      };

      function showNotification(message, type) {
        const notification = document.createElement("div");
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `<i class="fas fa-${type === "success" ? "check-circle" : "exclamation-triangle"}"></i> ${message}`;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 4000);
      }
    </script>
  </body>
</html>
