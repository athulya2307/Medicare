<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Medicare</title>
    <link rel="stylesheet" href="css/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body class="dashboard-page">
    <nav class="top-navbar">
      <div class="nav-left">
        <i class="fas fa-heartbeat"></i>
        <span>Medicare Dashboard</span>
      </div>
      <div class="nav-right">
        <div class="user-profile">
          <img
            src="https://ui-avatars.com/api/?name=User&background=059669&color=fff&size=40"
            alt="Profile"
            class="profile-img"
            id="profileImg"
          />
          <span id="userName">User</span>
          <span class="role-badge" id="userRole"></span>
        </div>
        <button class="btn-logout" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </nav>

    <div class="dashboard-wrapper">
      <aside class="quick-actions-sidebar">
        <div class="sidebar-header">
          <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
        </div>
        <nav class="quick-actions-nav">
          <a href="#" class="action-item" data-action="appointment">
            <i class="fas fa-calendar-plus"></i>
            <span>Book Appointment</span>
          </a>
          <a href="#" class="action-item" data-action="hospital">
            <i class="fas fa-map-marker-alt"></i>
            <span>Find Hospital</span>
          </a>
          <a href="#" class="action-item" data-action="report">
            <i class="fas fa-file-upload"></i>
            <span>Upload Report</span>
          </a>
          <a href="#" class="action-item" data-action="reminder">
            <i class="fas fa-plus"></i>
            <span>Add Reminder</span>
          </a>
        </nav>
      </aside>

      <main class="main-content">
        <header class="page-header">
          <h1 id="welcomeMsg">
            Welcome <span class="gradient-text" id="welcomeName">User</span>! ðŸ‘‹
          </h1>
          <p>Here's what's happening with your health today</p>
        </header>

        <section class="stats-section">
          <div class="stats-grid">
            <div class="stat-card primary">
              <div class="stat-icon">
                <i class="fas fa-weight-hanging"></i>
              </div>
              <div class="stat-numbers">
                <h3 id="bmiDisplay">0.0</h3>
                <p>BMI <span id="bmiStatus">(Enter metrics)</span></p>
              </div>
            </div>
            <div class="stat-card success">
              <div class="stat-icon">
                <i class="fas fa-tint"></i>
              </div>
              <div class="stat-numbers">
                <h3>0</h3>
                <p>Upcoming<br />Appointments</p>
              </div>
            </div>
            <div class="stat-card warning">
              <div class="stat-icon">
                <i class="fas fa-bell"></i>
              </div>
              <div class="stat-numbers">
                <h3>0</h3>
                <p>Pending<br />Reminders</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Health Metrics -->
        <section class="metrics-section">
          <div class="metrics-card">
            <div class="card-header">
              <h2><i class="fas fa-chart-bar"></i> Update Health Metrics</h2>
              <button class="btn-clear" onclick="clearMetrics()">
                Clear All
              </button>
            </div>
            <form class="metrics-form" onsubmit="saveMetrics(event)">
              <div class="metrics-grid">
                <div class="metric-input">
                  <label
                    ><i class="fas fa-weight-hanging"></i> Weight (kg)</label
                  >
                  <input
                    type="number"
                    id="weight"
                    value="0"
                    step="0.1"
                    class="input-metric"
                    oninput="calculateBMI()"
                  />
                </div>
                <div class="metric-input">
                  <label
                    ><i class="fas fa-ruler-vertical"></i> Height (cm)</label
                  >
                  <input
                    type="number"
                    id="height"
                    value="0"
                    step="0.1"
                    class="input-metric"
                    oninput="calculateBMI()"
                  />
                </div>
                <div class="metric-input">
                  <label><i class="fas fa-tint"></i> Blood Sugar (mg/dL)</label>
                  <input
                    type="number"
                    id="bloodSugar"
                    value="0"
                    step="0.1"
                    class="input-metric"
                  />
                </div>
                <div class="metric-input">
                  <label
                    ><i class="fas fa-heart"></i> BP (Systolic/Diastolic)</label
                  >
                  <input
                    type="text"
                    id="bloodPressure"
                    value="0/0"
                    class="input-metric"
                  />
                </div>
              </div>

              <div class="bmi-preview">
                <div class="bmi-circle normal" id="bmiCircle">
                  <div class="bmi-display">
                    <span class="bmi-value" id="bmiValue">0.0</span>
                    <span class="bmi-label" id="bmiLabel"
                      >Enter metrics to calculate</span
                    >
                  </div>
                </div>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn-primary btn-large">
                  <i class="fas fa-save"></i> Save Metrics
                </button>
              </div>
            </form>
          </div>
        </section>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const currentUser = JSON.parse(
          localStorage.getItem("medicare_current_user") || "{}",
        );

        if (currentUser && currentUser.name) {
          document.getElementById("welcomeName").textContent = currentUser.name;
          document.getElementById("userName").textContent = currentUser.name;

          document.getElementById("profileImg").src =
            `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.name)}&background=059669&color=fff&size=40`;

          // Update role badge
          if (currentUser.role) {
            const roleBadge = document.getElementById("userRole");
            roleBadge.textContent =
              currentUser.role.charAt(0).toUpperCase() +
              currentUser.role.slice(1);
            roleBadge.className = `role-badge ${currentUser.role}`;
          }

          loadMetrics();
        } else {
          window.location.href = "login.html";
        }
      });

      function calculateBMI() {
        const weight = parseFloat(document.getElementById("weight").value) || 0;
        const height = parseFloat(document.getElementById("height").value) || 0;

        if (weight > 0 && height > 0) {
          const heightInMeters = height / 100;
          const bmi = (weight / (heightInMeters * heightInMeters)).toFixed(1);

          document.getElementById("bmiValue").textContent = bmi;
          document.getElementById("bmiDisplay").textContent = bmi;

          let status = "Normal";
          let circleClass = "normal";
          if (bmi < 18.5) {
            status = "Underweight";
            circleClass = "underweight";
          } else if (bmi >= 25) {
            status = "Overweight";
            circleClass = "overweight";
          }

          document.getElementById("bmiLabel").textContent = status + " BMI";
          document.getElementById("bmiStatus").textContent = `(${status})`;
          document.getElementById("bmiCircle").className =
            `bmi-circle ${circleClass}`;
        }
      }

      function saveMetrics(event) {
        event.preventDefault();

        const metrics = {
          weight: document.getElementById("weight").value,
          height: document.getElementById("height").value,
          bloodSugar: document.getElementById("bloodSugar").value,
          bloodPressure: document.getElementById("bloodPressure").value,
          bmi: document.getElementById("bmiValue").textContent,
        };

        const currentUser = JSON.parse(
          localStorage.getItem("medicare_current_user"),
        );
        const users = JSON.parse(
          localStorage.getItem("medicare_users") || "[]",
        );
        const userIndex = users.findIndex((u) => u.email === currentUser.email);

        if (userIndex !== -1) {
          users[userIndex].weight = metrics.weight;
          users[userIndex].height = metrics.height;
          users[userIndex].bloodSugar = metrics.bloodSugar;
          users[userIndex].bloodPressure = metrics.bloodPressure;
          users[userIndex].bmi = parseFloat(metrics.bmi);
          localStorage.setItem("medicare_users", JSON.stringify(users));
        }

        showNotification("Metrics saved successfully!", "success");
      }

      function loadMetrics() {
        const currentUser = JSON.parse(
          localStorage.getItem("medicare_current_user"),
        );
        const users = JSON.parse(
          localStorage.getItem("medicare_users") || "[]",
        );
        const user = users.find((u) => u.email === currentUser.email);

        if (user) {
          document.getElementById("weight").value = user.weight || 0;
          document.getElementById("height").value = user.height || 0;
          document.getElementById("bloodSugar").value = user.bloodSugar || 0;
          document.getElementById("bloodPressure").value =
            user.bloodPressure || "0/0";
          document.getElementById("bmiDisplay").textContent = user.bmi || 0;
          calculateBMI();
        }
      }

      function clearMetrics() {
        document.getElementById("weight").value = 0;
        document.getElementById("height").value = 0;
        document.getElementById("bloodSugar").value = 0;
        document.getElementById("bloodPressure").value = "0/0";
        calculateBMI();
      }

      function logout() {
        localStorage.removeItem("medicare_current_user");
        window.location.href = "login.html";
      }

      function showNotification(message, type) {
        const notification = document.createElement("div");
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `<i class="fas fa-${type === "success" ? "check-circle" : "exclamation-triangle"}"></i> ${message}`;
        document.body.appendChild(notification);

        setTimeout(() => {
          notification.remove();
        }, 4000);
      }
    </script>
  </body>
</html>
